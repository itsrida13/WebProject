<!-- views/my-orders.ejs -->

<style>
  .orders-page-bg {
    padding: 40px 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .orders-container {
    max-width: 1100px;
    margin: 0 auto;
    background: white;
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  }

  .orders-container h1 {
    color: #333;
    font-size: 36px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .subtitle {
    color: #666;
    margin-bottom: 30px;
    font-size: 16px;
  }

  .search-form {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 30px;
    border-radius: 12px;
    margin-bottom: 30px;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
  }

  .search-form h3 {
    color: white;
    margin-bottom: 15px;
    font-size: 18px;
  }

  .search-form form {
    display: flex;
    gap: 15px;
    align-items: center;
    flex-wrap: wrap;
  }

  .search-form input {
    flex: 1;
    min-width: 250px;
    padding: 14px 20px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    outline: none;
    transition: all 0.3s;
  }

  .search-form input:focus {
    box-shadow: 0 0 0 3px rgba(255,255,255,0.3);
  }

  .search-form button {
    padding: 14px 35px;
    background: white;
    color: #667eea;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }

  .search-form button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
  }

  .order-card {
    border: 2px solid #e0e0e0;
    padding: 25px;
    margin: 20px 0;
    border-radius: 12px;
    transition: all 0.3s;
    background: white;
  }

  .order-card:hover {
    border-color: #667eea;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
    transform: translateY(-2px);
  }

  .order-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #f0f0f0;
    flex-wrap: wrap;
    gap: 15px;
  }

  .order-number {
    font-size: 20px;
    font-weight: bold;
    color: #333;
    display: flex;
    flex-direction: column;
    gap: 5px;
  }

  .order-date {
    color: #999;
    font-size: 14px;
    font-weight: normal;
  }

  .status {
    padding: 8px 20px;
    border-radius: 25px;
    font-size: 14px;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .status.placed { 
    background: linear-gradient(135deg, #FFF3CD, #FFE69C);
    color: #856404;
    border: 2px solid #FFE69C;
  }
  .status.processing { 
    background: linear-gradient(135deg, #CCE5FF, #99CAFF);
    color: #004085;
    border: 2px solid #99CAFF;
  }
  .status.delivered { 
    background: linear-gradient(135deg, #D4EDDA, #A8DDB5);
    color: #155724;
    border: 2px solid #A8DDB5;
  }

  .order-details {
    display: grid;
    gap: 12px;
  }

  .detail-row {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px dashed #e0e0e0;
  }

  .detail-row:last-child {
    border-bottom: none;
  }

  .detail-row strong {
    color: #555;
    font-weight: 600;
  }

  .detail-row span {
    color: #333;
  }

  .discount-text {
    color: #28a745 !important;
    font-weight: bold;
  }

  .total-amount {
    font-size: 22px !important;
    font-weight: bold !important;
    color: #667eea !important;
  }

  .error {
    background: linear-gradient(135deg, #ffebee, #ffcdd2);
    color: #c62828;
    padding: 20px;
    border-radius: 8px;
    margin: 20px 0;
    border-left: 5px solid #f44336;
    font-weight: 500;
  }

  .success {
    background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
    color: #2e7d32;
    padding: 20px;
    border-radius: 8px;
    margin: 20px 0;
    border-left: 5px solid #4caf50;
    font-weight: 500;
  }

  .no-orders {
    text-align: center;
    padding: 60px 20px;
    color: #666;
  }

  .no-orders h3 {
    font-size: 24px;
    color: #333;
    margin-bottom: 15px;
  }

  .no-orders p {
    font-size: 16px;
    color: #666;
  }

  .no-orders .icon {
    font-size: 80px;
    margin-bottom: 20px;
    opacity: 0.3;
  }

  .items-list {
    margin-top: 15px;
    padding: 15px;
    background: #f9f9f9;
    border-radius: 8px;
  }

  .items-list h4 {
    margin-bottom: 10px;
    color: #333;
  }

  .item {
    padding: 8px 0;
    color: #555;
    font-size: 14px;
  }

  @media (max-width: 768px) {
    .orders-container {
      padding: 20px;
    }

    .orders-container h1 {
      font-size: 28px;
    }

    .order-header {
      flex-direction: column;
      align-items: flex-start;
    }

    .search-form form {
      flex-direction: column;
    }

    .search-form input {
      width: 100%;
    }
  }
</style>

<div class="orders-page-bg">
  <div class="orders-container">
    <h1>üì¶ My Orders</h1>
    <p class="subtitle">Track your order history and status</p>

    <div class="search-form">
      <h3>üîç Search Your Orders</h3>
      <form method="POST" action="/order/my-orders">
        <input 
          type="email" 
          name="email" 
          placeholder="Enter your email address" 
          value="<%= email %>" 
          required>
        <button type="submit">Search Orders</button>
      </form>
    </div>

    <% if (error) { %>
      <div class="error">
        ‚ö†Ô∏è <%= error %>
      </div>
    <% } %>

    <% if (orders && orders.length > 0) { %>
      <div class="success">
        ‚úÖ Found <%= orders.length %> order<%= orders.length > 1 ? 's' : '' %> for <%= email %>
      </div>
      
      <% orders.forEach(order => { %>
        <div class="order-card">
          <div class="order-header">
            <div class="order-number">
              <%= order.orderNumber %>
              <span class="order-date">
                üìÖ <%= new Date(order.createdAt).toLocaleDateString('en-US', { 
                  year: 'numeric', 
                  month: 'long', 
                  day: 'numeric',
                  hour: '2-digit',
                  minute: '2-digit'
                }) %>
              </span>
            </div>
            <span class="status <%= order.status.toLowerCase() %>">
              <%= order.status %>
            </span>
          </div>

          <div class="order-details">
            <div class="detail-row">
              <strong>üë§ Customer:</strong>
              <span><%= order.customerName %></span>
            </div>
            <div class="detail-row">
              <strong>üìß Email:</strong>
              <span><%= order.customerEmail %></span>
            </div>
            <div class="detail-row">
              <strong>üì¶ Total Items:</strong>
              <span><%= order.items.length %> item<%= order.items.length > 1 ? 's' : '' %></span>
            </div>
            <div class="detail-row">
              <strong>üíµ Subtotal:</strong>
              <span>Rs. <%= order.subtotal.toLocaleString() %></span>
            </div>

            <% if (order.discount > 0) { %>
              <div class="detail-row">
                <strong>üéüÔ∏è Discount (<%= order.discountCode %>):</strong>
                <span class="discount-text">- Rs. <%= order.discount.toLocaleString() %></span>
              </div>
            <% } %>

            <div class="detail-row">
              <strong>üí∞ Grand Total:</strong>
              <span class="total-amount">Rs. <%= order.grandTotal.toLocaleString() %></span>
            </div>
          </div>

          <div class="items-list">
            <h4>üìã Order Items:</h4>
            <% order.items.forEach((item, index) => { %>
              <div class="item">
                <%= index + 1 %>. <%= item.name %> - 
                Rs. <%= item.price.toLocaleString() %> √ó <%= item.quantity %> = 
                <strong>Rs. <%= (item.price * item.quantity).toLocaleString() %></strong>
              </div>
            <% }) %>
          </div>
        </div>
      <% }) %>
    <% } else if (email) { %>
      <div class="no-orders">
        <div class="icon">üì≠</div>
        <h3>No Orders Found</h3>
        <p>No orders have been placed with the email: <strong><%= email %></strong></p>
        <p>Please check your email address and try again.</p>
      </div>
    <% } %>
  </div>
</div>
